<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="../../style.css" />
    <script src="../../../lib/webviewer.min.js"></script>
    <script src="../../old-browser-checker.js"></script>
    <script src="../../global.js"></script>
    <title>JavaScript PDF Viewer Custom Annotation Demo</title>
    <script src="../../modernizr.custom.min.js"></script>

    <style>
      .wrapper{
        margin-top: 150px;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="title sample">Custom Annotation Demo for PDF Viewer</div>
    </header>
    <aside>
      <h1>Controls</h1>
      <h2>Custom annotation tools</h2>
      <input type="checkbox" id="custom-triangle-tool" />
      <label for="custom-triangle-tool">Custom triangle tool</label>
      <br />
      <input type="checkbox" id="custom-stamp" />
      <label for="custom-stamp">Custom stamp tool</label>
      <h2>Sample stamp</h2>
      <div> 
        <img id="sample-image" draggable="" src="./stamp.png" />
      </div>
      <h2>Add a custom stamp</h2>
      <input id="file-open" type="file" />
      <hr />
      <h1>Instructions</h1>
      <p>Toggle checkboxes to create/destroy custom annotation tools.</p>
      <p>Click the sample image to add a stamp</p>
      <p>Create your own custom stamp</p>
    </aside>
    <div id="viewer"></div>
    <script src="../../menu-button.js"></script>  

    <!--ga-tag-->

    <script>
      Modernizr.addTest('async', function() {
        try {
          var result;
          eval('let a = () => {result = "success"}; let b = async () => {await a()}; b()');
          return result === 'success';
        } catch (e) {
          return false;
        }
      });

      // test for async and fall back to code compiled to ES5 if they are not supported
      [
        'stamp.js',
        './triangle/triangle-control-handle.js',
        './triangle/triangle-selection-model.js',
        './triangle/triangle-annotation.js',
        './triangle/triangle-create-tool.js',
        'custom-annotations.js',
      ].forEach(function(js) {
        var script = Modernizr.async ? js : js.replace('.js', '.ES5.js');
        var scriptTag = document.createElement('script');
        scriptTag.src = script;
        scriptTag.type = 'text/javascript';
        document.getElementsByTagName('head')[0].appendChild(scriptTag);
      });
    </script>

    <div class="wrapper">
        
        <div class="form">
            <input type="text" placeholder="Enter URL">
            <button>Generate QR Code</button>
        </div>
        
        <!-- <div class="qr-code">
            <img src="" id="qr-image" draggable="true" alt="">
        </div>
       -->



        <!-- Idhu thani code u -->

        <h1>JavaScript - Drag and Drop</h1>
        <div class="wrapper1">
          <div class="box" id="box1"> 
            <div class="qr-code">
              
            <img src="" id="qr-image" draggable="true" alt="">
            </div>
           </div>
        </div>
        <div class="drop-targets">
        
            <div class="box"></div>
        </div>
        <!--  -->

    </div>

    <script >


const wrapper = document.querySelector(".wrapper"),//gets the wrapper css and stores it in the wrapper variable
qrInput=wrapper.querySelector(".form input"),//gets the form input css and stores it in the qrInput variable
qrImg=wrapper.querySelector(".qr-code img"),//gets the qr-code img and stores it in the qrImg variable
generateBtn=wrapper.querySelector(".form button");//gets the form button css and stores it in the henerateBtn variable



/* This block of code executes when the user clicks on the generate button after entering a value(i.e a valid url or even a text) */
generateBtn.addEventListener("click",()=>{
    let qrValue = qrInput.value;
    if(!qrValue) return;
    generateBtn.innerText= "Generating QR Code....";
    qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=170x170&data=${qrValue}`;

   
    qrImg.addEventListener("load", ()=>{
        wrapper.classList.add("active");
        generateBtn.innerText= "Generate QR Code";
    })
    
   
});

qrInput.addEventListener("keyup", ()=>{
    if (!qrInput.value) {
        wrapper.classList.remove("active");
    }
})


// IDHU THANI CODE- U================================================================================================

window.createStampTool = instance => {
  const { documentViewer, annotationManager, Annotations, Tools } = instance.Core;

  // Custom stamp tool constructor that inherits generic annotation create tool
  class CustomStampCreateTool extends Tools.GenericAnnotationCreateTool {
    constructor() {
      // Inherit generic annotation create tool
      super(documentViewer, Annotations.StampAnnotation);
      delete this.defaults.StrokeColor;
      delete this.defaults.FillColor;
      delete this.defaults.StrokeThickness;
    }

    // Override mouseLeftDown
    mouseLeftDown(...args) {
      Tools.AnnotationSelectTool.prototype.mouseLeftDown.apply(this, args);
    }

    // Override mouseMove
    mouseMove(...args) {
      Tools.AnnotationSelectTool.prototype.mouseMove.apply(this, args);
    }

    // Override mouseLeftUp
    mouseLeftUp(e) {
      super.mouseLeftDown(e);

      let annotation;
      if (this.annotation) {
        let width = 212;
        let height = 60;
        const rotation = this.documentViewer.getCompleteRotation(this.annotation.PageNumber) * 90;
        this.annotation.Rotation = rotation;
        if (rotation === 270 || rotation === 90) {
          const t = height;
          height = width;
          width = t;
        }
        // 'ImageData' can be a bas64 ImageString or an URL. If it's an URL, relative paths will cause issues when downloading
        this.annotation.setImageData(qrImage);
        this.annotation.Width = width;
        this.annotation.Height = height;
        this.annotation.X -= width / 2;
        this.annotation.Y -= height / 2;
        this.annotation.MaintainAspectRatio = true;
        annotation = this.annotation;
      }

      super.mouseLeftUp(e);

      if (annotation) {
        annotationManager.redrawAnnotation(annotation);
      }
    }
  }

  return new CustomStampCreateTool();
};


// The END of Thani code -u ====================================================================================================


    </script>

</div>
  </body>
</html>
